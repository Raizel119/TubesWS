<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ book.Judul }} - Bookara</title>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=search" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>

{% set placeholder_img = url_for('static', filename='img/placeholder.jpg') %}

<header class="navbar">
    <div class="container">
        <div class="navbar-left">
            <a href="/" class="navbar-brand">
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Bookara Logo">
            </a>

            <div class="dropdown">
                <a href="/" class="nav-link">Kategori <span class="arrow"></span></a>
                <div class="dropdown-content">
                    {% for cat in all_categories[:15] %}
                        <a href="/?filter=cat_{{ cat | uquote }}">{{ cat }}</a>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="navbar-center">
            <div class="search-bar-container">
                <form action="/" method="GET" class="search-bar" id="search-form">
                    <span class="material-symbols-outlined">search</span>
                    <input type="text" name="query" id="search-input" placeholder="Cari Judul Buku atau Penulis" autocomplete="off">
                </form>

                <div class="search-history" id="search-history-dropdown">
                    <div class="history-header">
                        <h3>Riwayat Pencarian</h3>
                        <button type="button" class="clear-history-btn" id="clear-history">Hapus Semua</button>
                    </div>
                    <ul class="history-list" id="history-list"></ul>
                </div>
            </div>
        </div>

        <nav class="navbar-right">
            <a href="/" class="nav-link">Home</a>
            <a href="#" class="nav-link">About Us</a>
            <a href="#" class="nav-link">Contact</a>
        </nav>
    </div>
</header>

<main class="main-content container">

    <nav class="breadcrumb">
        <a href="/">Home</a> &gt;
        <a href="/?filter=cat_{{ book.KategoriUtama | uquote }}">{{ book.KategoriUtama }}</a>
        &gt; <span>{{ book.Judul }}</span>
    </nav>

    <div class="book-detail-card">
        <div class="card-image" style="margin: 0; width: 100%;">
            {% if book.Gambar and book.Gambar != 'Tidak ditemukan' and book.Gambar|length > 5 %}
                <img src="{{ book.Gambar }}" 
                     alt="{{ book.Judul }}"
                     onerror="this.onerror=null; this.src='{{ placeholder_img }}';">
            {% else %}
                <img src="{{ placeholder_img }}" 
                     alt="Gambar Tidak Tersedia">
            {% endif %}
        </div>

        <div class="book-detail-info">

            <p class="detail-author">{{ book.Penulis }}</p>
            <h1>{{ book.Judul }}</h1>

            {% if book.Harga %}
            <p class="detail-price">{{ book.Harga }}</p>
            {% endif %}

            <div class="detail-info-block">
                <h4>Format Buku</h4>
                <p>{{ book.Format or 'Soft Cover' }}</p>
            </div>

            <div class="detail-info-block">
                <h4>Deskripsi</h4>
                <div class="detail-description">
                    {% if book.Deskripsi and book.Deskripsi != 'Tidak ditemukan' %}
                        {{ book.Deskripsi | safe}}
                    {% else %}
                        <p>Tidak ada deskripsi untuk buku ini.</p>
                    {% endif %}
                </div>
            </div>

            <div class="detail-info-block">
                <h4>Detail Buku</h4>

                <div class="detail-specs-grid">
                    <div class="jd">
                        <p><strong>Penerbit</strong></p>
                        <p>{{ book.Penerbit }}</p>
                    </div>

                    <div class="jd">
                        <p><strong>Tanggal Terbit</strong></p>
                        <p>{{ book.TanggalTerbit }}</p>
                    </div>

                    <div class="jd">
                        <p><strong>ISBN</strong></p>
                        <p>{{ book.ISBN }}</p>
                    </div>

                    <div class="jd">
                        <p><strong>Halaman</strong></p>
                        <p>{{ book.Halaman }}</p>
                    </div>

                    <div class="jd">
                        <p><strong>Bahasa</strong></p>
                        <p>{{ book.Bahasa }}</p>
                    </div>

                    <div class="jd">
                        <p><strong>Panjang</strong></p>
                        <p>{{ book.Panjang }}</p>
                    </div>

                    <div class="jd">
                        <p><strong>Lebar</strong></p>
                        <p>{{ book.Lebar }}</p>
                    </div>

                    <div class="jd">
                        <p><strong>Berat</strong></p>
                        <p>{{ book.Berat }}</p>
                    </div>

                    <div class="jd">
                        <p><strong>Link Gramedia</strong></p>
                        <p>
                            {% if book.URL and book.URL != '#' %}
                                <a href="{{ book.URL }}" target="_blank" style="color: #A695FF; text-decoration: underline;">
                                    Buka Website <i class="fas fa-external-link-alt" style="font-size: 0.8em;"></i>
                                </a>
                            {% else %}
                                -
                            {% endif %}
                        </p>
                    </div>

                </div>
            </div>

        </div>
    </div> 
        {% if author_dbpedia %}
    <div class="author-dbpedia-section" style="margin-top: 50px; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
            <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 10px;">
                <i class="fas fa-globe" style="font-size: 32px; color: #fff;"></i>
            </div>
            <div>
                <h2 style="color: #fff; margin: 0; font-size: 24px;">Informasi Penulis dari DBpedia</h2>
                <p style="color: rgba(255,255,255,0.8); margin: 5px 0 0 0; font-size: 13px;">
                    Data real-time dari Linked Open Data
                </p>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: auto 1fr; gap: 30px; background: rgba(255,255,255,0.95); padding: 25px; border-radius: 12px;">
            
            <!-- Foto Penulis -->
            {% if author_dbpedia.thumbnail %}
            <div style="text-align: center;">
                <img src="{{ author_dbpedia.thumbnail }}" 
                     alt="{{ book.Penulis }}" 
                     style="width: 180px; height: 240px; object-fit: cover; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); border: 4px solid #fff;"
                     onerror="this.style.display='none';">
                <p style="margin-top: 10px; font-size: 12px; color: #666;">
                    <i class="fas fa-camera"></i> Sumber: DBpedia
                </p>
            </div>
            {% endif %}

            <!-- Detail Info -->
            <div>
                <h3 style="color: #667eea; margin-bottom: 15px; font-size: 20px;">
                    <i class="fas fa-user-circle"></i> {{ book.Penulis }}
                </h3>

                <!-- Tanggal Lahir -->
                {% if author_dbpedia.birthDate %}
                <div style="margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-birthday-cake" style="color: #764ba2; width: 20px;"></i>
                    <div>
                        <strong style="color: #333;">Tanggal Lahir:</strong>
                        <span style="color: #555;">{{ author_dbpedia.birthDate[:10] }}</span>
                    </div>
                </div>
                {% endif %}

                <!-- Tanggal Wafat -->
                {% if author_dbpedia.deathDate %}
                <div style="margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-cross" style="color: #764ba2; width: 20px;"></i>
                    <div>
                        <strong style="color: #333;">Tanggal Wafat:</strong>
                        <span style="color: #555;">{{ author_dbpedia.deathDate[:10] }}</span>
                    </div>
                </div>
                {% endif %}

                <!-- Kewarganegaraan -->
                {% if author_dbpedia.nationality %}
                <div style="margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-flag" style="color: #764ba2; width: 20px;"></i>
                    <div>
                        <strong style="color: #333;">Kewarganegaraan:</strong>
                        <span style="color: #555;">{{ author_dbpedia.nationality }}</span>
                    </div>
                </div>
                {% endif %}

                <!-- Biografi -->
                {% if author_dbpedia.abstract %}
                <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e0e0e0;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">
                        <i class="fas fa-book-open"></i> Biografi
                    </h4>
                    <p style="color: #555; line-height: 1.7; text-align: justify; font-size: 14px;">
                        {{ author_dbpedia.abstract[:500] }}
                        {% if author_dbpedia.abstract|length > 500 %}...{% endif %}
                    </p>
                </div>
                {% endif %}

                <!-- Link DBpedia -->
                {% if author_dbpedia.uri %}
                <div style="margin-top: 20px;">
                    <a href="{{ author_dbpedia.uri }}" 
                       target="_blank" 
                       style="display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; padding: 10px 20px; border-radius: 25px; text-decoration: none; font-weight: 600; font-size: 13px; transition: transform 0.2s;">
                        <i class="fas fa-external-link-alt"></i>
                        Lihat di DBpedia
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Badge Linked Open Data -->
        <div style="margin-top: 15px; text-align: right;">
            <span style="background: rgba(255,255,255,0.2); color: #fff; padding: 6px 15px; border-radius: 20px; font-size: 11px; font-weight: 600;">
                <i class="fas fa-link"></i> Powered by Linked Open Data (LOD)
            </span>
        </div>
    </div>
    {% else %}
    <!-- Jika data tidak ditemukan di DBpedia -->
    <div style="margin-top: 30px; padding: 20px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 8px;">
        <p style="margin: 0; color: #856404;">
            <i class="fas fa-info-circle"></i> 
            <strong>Info:</strong> Data penulis tidak ditemukan di DBpedia. Menampilkan data lokal saja.
        </p>
    </div>
    {% endif %}
    {% if film_dbpedia %}
    <div class="film-dbpedia-section" style="margin-top: 30px; padding: 30px; background: #1a1a1a; border-radius: 15px; color: #fff; position: relative; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
        
        <div style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: rgba(229, 9, 20, 0.2); border-radius: 50%; filter: blur(50px);"></div>

        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 25px; position: relative; z-index: 2;">
            <div style="background: #e50914; padding: 12px; border-radius: 8px;">
                <i class="fas fa-film" style="font-size: 28px; color: #fff;"></i>
            </div>
            <div>
                <h2 style="color: #fff; margin: 0; font-size: 24px;">Diadaptasi ke Layar Lebar</h2>
                <p style="color: #bbb; margin: 5px 0 0 0; font-size: 13px;">Based on {{ book.Judul }}</p>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: auto 1fr; gap: 30px; position: relative; z-index: 2;">
            
            {% if film_dbpedia.poster %}
            <div style="text-align: center;">
                <img src="{{ film_dbpedia.poster }}" 
                     alt="{{ film_dbpedia.title }}" 
                     style="width: 160px; border-radius: 8px; box-shadow: 0 0 20px rgba(255,255,255,0.1);"
                     onerror="this.style.display='none';">
            </div>
            {% endif %}

            <div>
                <h3 style="color: #e50914; font-size: 22px; margin-top: 0; margin-bottom: 15px;">
                    {{ film_dbpedia.title }}
                </h3>

                <div style="margin-bottom: 20px;">
                    {% if film_dbpedia.director %}
                    <div>
                        <span style="display: block; font-size: 12px; color: #888; text-transform: uppercase;">Sutradara</span>
                        <span style="font-size: 16px; font-weight: 600; color: #fff;">{{ film_dbpedia.director }}</span>
                    </div>
                    {% endif %}
                </div>

                {% if film_dbpedia.abstract %}
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <p style="margin: 0; font-size: 13px; line-height: 1.6; color: #ddd; font-style: italic;">
                        "{{ film_dbpedia.abstract[:250] }}..."
                    </p>
                </div>
                {% endif %}

                <a href="{{ film_dbpedia.uri }}" target="_blank" 
                   style="display: inline-block; background: #e50914; color: white; padding: 8px 20px; text-decoration: none; border-radius: 4px; font-size: 13px; font-weight: 600;">
                    Lihat di DBpedia
                </a>
            </div>
        </div>
    </div>
    {% endif %}
    {% if more_books %}
    <div class="category-shelf" style="margin-top: 60px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
        <div class="shelf-header" style="padding-left: 0;">
            <h3>Lainnya dari {{ book.Penulis }}</h3>
        </div>
        
        <div class="book-list-horizontal" style="padding-left: 0;">
            {% for b in more_books %}
            <div class="book-card-small">
                <a href="/book/{{ b.id }}" class="card-link">
                    <div class="card-image">
                        {% if b.Gambar and b.Gambar != 'Tidak ditemukan' and b.Gambar|length > 5 %}
                            <img src="{{ b.Gambar }}" 
                                 alt="{{ b.Judul }}" 
                                 onerror="this.onerror=null; this.src='{{ placeholder_img }}';">
                        {% else %}
                            <img src="{{ placeholder_img }}" alt="Gambar Tidak Tersedia">
                        {% endif %}
                    </div>
                    <div class="card-content">
                        <p class="author">{{ b.Penulis }}</p>
                        <h5 class="title">{{ b.Judul }}</h5>
                        {% if b.Harga %}
                        <p class="price" style="font-weight:700; font-size:0.9em; color:#A695FF;">{{ b.Harga }}</p>
                        {% endif %}
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

</main>

<footer class="footer">
    <div class="footer-top">
        <div class="footer-logo">
            <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Bookara" />
        </div>
        <div class="footer-tagline">
            Search Smarter. Read Better.
        </div>
    </div>

    <div class="footer-container">
        <div class="footer-column">
            <h3>Company</h3>
            <a href="#">Home</a>
            <a href="#">About Us</a>
            <a href="#">Kategori</a>
            <a href="#">Contact</a>
        </div>

        <div class="footer-column">
            <h3>Support</h3>
            <a href="#">Help Center</a>
            <a href="#">How It Works</a>
            <a href="#">Report an Issue</a>
        </div>

        <div class="footer-column">
            <h3>Legal</h3>
            <a href="#">Privacy Policy</a>
            <a href="#">Terms of Service</a>
            <a href="#">Cookie Policy</a>
            <a href="#">Content Guidelines</a>
        </div>

        <div class="footer-column">
            <h3>Contact Information</h3>
            <a href="#">Email Support</a>
            <a href="#">Business Inquiries</a>

            <p style="margin-top:10px; font-weight:600">Social Media Links:</p>
            <div class="social-icons">
                <i class="fab fa-instagram"></i>
                <i class="fab fa-x-twitter"></i>
                <i class="fab fa-facebook"></i>
                <i class="fab fa-linkedin"></i>
            </div>
        </div>
    </div>

    <div class="footer-bottom">
        Â© 2025 Bookora. All rights reserved.
    </div>
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchForm = document.getElementById('search-form');
    const searchInput = document.getElementById('search-input');
    const historyDropdown = document.getElementById('search-history-dropdown');
    const historyList = document.getElementById('history-list');
    const clearHistoryBtn = document.getElementById('clear-history');

    let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];

    function renderHistory() {
        historyList.innerHTML = '';
        if (searchHistory.length === 0) {
            historyList.innerHTML = '<li class="history-empty">Belum ada riwayat pencarian</li>';
            clearHistoryBtn.style.display = 'none';
            return;
        }

        clearHistoryBtn.style.display = 'block';
        searchHistory.forEach((term, index) => {
            const li = document.createElement('li');
            li.innerHTML = `
                <i class="fas fa-history"></i>
                <span class="history-term">${term}</span>
                <button type="button" class="delete-item-btn" data-index="${index}">&times;</button>
            `;
            historyList.appendChild(li);
        });
    }

    searchInput.addEventListener('focus', () => {
        renderHistory();
        historyDropdown.style.display = 'block';
    });

    document.addEventListener('click', (e) => {
        if (!e.target.closest('.search-bar-container')) {
            historyDropdown.style.display = 'none';
        }
    });

    searchForm.addEventListener('submit', () => {
        const searchTerm = searchInput.value.trim();
        if (searchTerm) {
            if (searchHistory.includes(searchTerm)) {
                searchHistory = searchHistory.filter(t => t !== searchTerm);
            }
            searchHistory.unshift(searchTerm);
            searchHistory = searchHistory.slice(0, 5);
            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
        }
    });

    clearHistoryBtn.addEventListener('click', () => {
        searchHistory = [];
        localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
        renderHistory();
    });

    historyList.addEventListener('click', (e) => {
        if (e.target.classList.contains('delete-item-btn')) {
            e.stopPropagation();
            const index = e.target.getAttribute('data-index');
            searchHistory.splice(index, 1);
            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
            renderHistory();
        }

        if (e.target.classList.contains('history-term')) {
            searchInput.value = e.target.textContent;
            searchForm.submit();
        }
    });
});
</script>

</body>
</html>