<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasil Pencarian - Bookara</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https.googleapis.com">
    <link rel="preconnect" href="https.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <header class="navbar">
        <div class="container">
            <div class="navbar-left">
                <a href="/" class="navbar-brand">Bookara</a>
                <div class="dropdown">
                    <a href="/search" class="nav-link">Kategori <span class="arrow"></span></a>
                    <div class="dropdown-content">
                        {% for cat in all_categories %}
                            <a href="/search?filter=cat_{{ cat }}">{{ cat }}</a>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <nav class="navbar-right">
                <a href="/" class="nav-link">Home</a>
                <a href="#" class="nav-link">About Us</a>
                <a href="#" class="nav-link">Contact</a>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container page-layout">
            <aside class="filter-sidebar">
                <form action="/search" method="GET" class="filter-form-v2">
                    <input type="hidden" name="query" value="{{ search_query or '' }}">
                    <input type="hidden" name="sort_price" value="{{ selected_sort_price or '' }}">

                    <h2 class="filter-title">Filter</h2>
                    
                    <details class="filter-group" open>
                        <summary>Kategori</summary>
                        <div class="filter-options-list">
                            <label class="filter-item">
                                <input type="radio" name="filter" value="" 
                                       {% if not current_filter %}checked{% endif %} 
                                       onchange="this.form.submit()">
                                <span>Semua Kategori</span>
                            </label>
                            {% for cat in all_categories %}
                            <details class="filter-group-nested" 
                                     {% if current_filter == 'cat_' + cat or (current_filter and current_filter.startswith('sub_') and category_map[cat] and current_filter.replace('sub_', '') in category_map[cat]) %}open{% endif %}>
                                <summary>
                                    <label class="filter-item">
                                        <input type="radio" name="filter" value="cat_{{ cat }}"
                                               {% if current_filter == 'cat_' + cat %}checked{% endif %}
                                               onchange="this.form.submit()">
                                        <span>{{ cat }}</span>
                                    </label>
                                </summary>
                                <div class="filter-options-nested">
                                    {% for sub_cat in category_map[cat] %}
                                    <label class="filter-item">
                                        <input type="radio" name="filter" value="sub_{{ sub_cat }}"
                                               {% if current_filter == 'sub_' + sub_cat %}checked{% endif %}
                                               onchange="this.form.submit()">
                                        <span>{{ sub_cat }}</span>
                                    </label>
                                    {% endfor %}
                                </div>
                            </details>
                            {% endfor %}
                        </div>
                    </details>
                    
                    <details class="filter-group" open>
                        <summary>Bahasa</summary>
                        <div class="filter-options-list">
                            <label class="filter-item">
                                <input type="radio" name="lang" value="all" 
                                       {% if current_lang == 'all' %}checked{% endif %} 
                                       onchange="this.form.submit()">
                                <span>Semua Bahasa</span>
                            </label>
                            {% for lang in all_languages %}
                            <label class="filter-item">
                                <input type="radio" name="lang" value="{{ lang }}" 
                                       {% if current_lang == lang %}checked{% endif %} 
                                       onchange="this.form.submit()">
                                <span>{{ lang }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </details>
                </form>
            </aside>

            <section class="results-content">
                <form action="/search" method="GET" class="home-search-form">
                    <input type="hidden" name="filter" value="{{ current_filter or '' }}">
                    <input type="hidden" name="lang" value="{{ current_lang or 'all' }}">
                    <input type="hidden" name="sort_price" value="{{ selected_sort_price or '' }}">
                    <input type="text" name="query" placeholder="Cari Judul Buku atau Penulis..." value="{{ search_query or '' }}">
                    <button type="submit">Cari</button>
                </form>

                <div class="results-header">
                    <div class="results-count">
                        Menampilkan <strong>{{ results_count }}</strong> dari <strong>{{ total_count }}</strong> produk
                        {% if search_query %}
                            untuk "<strong>{{ search_query }}</strong>"
                        {% endif %}
                    </div>
                    <form action="/search" method="GET" class="sort-form">
                        <input type="hidden" name="query" value="{{ search_query or '' }}">
                        <input type="hidden" name="filter" value="{{ current_filter or '' }}">
                        <input type="hidden" name="lang" value="{{ current_lang or 'all' }}">
                        <label for="sort_price">Urutkan:</label>
                        <select name="sort_price" id="sort_price" onchange="this.form.submit()">
                            <option value="">Paling Relevan</option>
                            <option value="asc" {% if selected_sort_price == 'asc' %}selected{% endif %}>
                                Harga Terendah (Naik)
                            </option>
                            <option value="desc" {% if selected_sort_price == 'desc' %}selected{% endif %}>
                                Harga Tertinggi (Turun)
                            </option>
                        </select>
                    </form>
                </div>

                <div class="results-grid">
                    {% for book in books %}
                        <div class="book-card-small">
                            <a href="/book/{{ book.id }}" class="card-link">
                                <div class="card-image">
                                    <img src="{{ book.image_url }}" alt="{{ book.title }}">
                                </div>
                                <div class="card-content">
                                    <p class="author">{{ book.author }}</p>
                                    <h5 class="title">{{ book.title }}</h5>
                                </div>
                            </a>
                        </div>
                    {% else %}
                        <div class="no-results">
                            <p>Maaf, buku tidak ditemukan dengan filter yang Anda pilih.</p>
                        </div>
                    {% endfor %}
                </div>
            </section>
        </div>
    </main>

    <footer class="footer">
        <div class="container footer-top">
            <div class="footer-brand">
                <a href="/" class="footer-logo">Bookara</a>
                <p class="footer-tagline">Search Smarter. Read Better.</p>
            </div>
            <div class="footer-links">
                <div class="footer-column">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Books</a></li>
                        <li><a href="#">Kategori</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Books</a></li>
                        <li><a href="#">Report an Issue</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Cookie Policy</a></li>
                        <li><a href="#">Contact Guidelines</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Contact Information</h4>
                    <ul>
                        <li><a href="#">Email Support</a></li>
                        <li><a href="#">Support Enquiries</a></li>
                    </ul>
                    <div class="social-media">
                        <a href="#" class="social-icon">I</a>
                        <a href="#" class="social-icon">T</a>
                        <a href="#" class.social-icon">G</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Bookara. All rights reserved.</p>
        </div>
    </footer>

</body>
</html>